<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Path Router Demo</title>
    <link rel="stylesheet" href="./demo-page.css">
    <link rel="stylesheet" href="./tabs.theme.css">
    <link rel="stylesheet" href="./heading-nav.theme.css">

    <style>
        main
        {
            display: grid;
        }
        browser-mockup::part(document)
        {
            display: flex;
            flex-direction: column;
        }
    </style>
</head>
<body>
    <menu id="demo-pages">
        <a href="./index.html">Basic Routing</a>
        <a href="./browser-navigation.html">Browser Navigation</a>
        <a href="./active-browser-navigation.html">Active Browser Navigation</a>
        <a href="./transitions.html">Transitions</a>
        <a href="./themes.html">Themes</a>
    </menu>
    <div id="demo-content">
        <header>Browser Navigation</header>
        <div class="description">
            <p>This page demonstrates how the path-router element's navigation events can be handled to manipulate your browser's history.</p>
            <p>To see how this effect can work, without actually changing your current browser history, see <a href="./browser-navigation.html">the Browser Navigation demo</a>.</p>
            <p>To see a demonstration that actually manipulates your browser's history, </p>
        </div>
        <main>
            <browser-mockup url="https://www.path-router.com" tabs="1" collapsed-tabs="2" class="windows">
                <div class="layout" data-theme="heading-nav">
                    <menu id="page-menu">
                        <a is="route-link" for="page-router" data-theme="heading-nav" path="/">Routing</a>
                        <a is="route-link" for="page-router" data-theme="heading-nav" path="/user">User</a>
                        <a is="route-link" for="page-router" data-theme="heading-nav" path="/help">Help</a>
                        <a is="route-link" for="page-router" data-theme="heading-nav" path="/help/faq">FAQ</a>
                        <a is="route-link" for="page-router" data-theme="heading-nav" path="/help/contact">Contact</a>
                    </menu>
                    <path-router id="page-router"data-theme="heading-nav" >
                        <path-route path="/">
                            <h3>Routing</h3>
                            <p>Routes can define simple routes, nested routes, and dialog routes, which provide a secondary routing path for displaying dialogs over existing route content.</p>
                            <button type="button" is="route-button" for="page-router" data-theme="heading-nav" path="#about">Open Dialog Route</button>
                            <p>Routes can include variables by using a colon character before the variable name (ex: 'routeA/:id' defines the route variable of "id" for the "routeA" route).</p>
                            <button type="button" is="route-button" for="page-router" data-theme="heading-nav" path="/user/1">Open User 1</button>
                            <button type="button" is="route-button" for="page-router" data-theme="heading-nav" path="/user/2">Open User 2</button>
                            <button type="button" is="route-button" for="page-router" data-theme="heading-nav" path="/user/3">Open User 3</button>
                            <p>Nested routes can be linked to from top-level path-router elements by using variables.</p>
                            <button type="button" is="route-button" for="page-router" data-theme="heading-nav" path="/user/1/contact/alice">Open Alice Contact</button>
                            <button type="button" is="route-button" for="page-router" data-theme="heading-nav" path="/user/1/contact/bob">Open Bob Contact</button>
                            <!-- Can't do this: -->
                            <!-- <a is="route-link" for="app-router" path="/help#about">Open About Dialog</a> -->
                            <!-- No automated way to know if the hash should be for the top level router, or a subrouter -->
                            <!-- Can move the dialog to top level and change link target router, or script from a page open event -->
                        </path-route>
                        <path-route path="/user/:id">
                            <h3>User</h3>
                            <p>Routes can be nested by adding a path-router element as a child of a path-route element.</p>
                            <nav>
                                <a is="route-link" for="user-router" data-theme="tabs" path="1/profile">Profile</a>
                                <a is="route-link" for="user-router" data-theme="tabs" path="1/contact">Contacts</a>
                            </nav>
                            <path-router id="user-router" data-theme="tabs">
                                <path-route path=":id/profile">
                                    <h4>User Profile</h4>
                                    <p>By giving the route a variable, like ":subpage", the remanining route can be passed down to the nested path-router element.</p>
                                </path-route>
                                <path-route path=":id/contact/:contactId">
                                    <path-router id="user-contact-router">
                                        <path-route path=":contactId/">
                                            <h4>User Contacts</h4>
                                            <p>Nested routes can also have path-router elements.</p>
                                            <p>By using variables and route-link elements, a nested path can be navigated to without any javascript needed for the implementer.</p>
                                            <nav>
                                                <style>
                                                    .link-button { padding: 0 .2em; cursor: pointer; }
                                                    .link-button:hover { text-decoration: underline ;}
                                                </style>
                                                <a is="route-link" for="user-contact-router" class="link-button" path="/alice">Alice</a>
                                                <a is="route-link" for="user-contact-router" class="link-button" path="/bob">Bob</a>
                                            </nav>
                                        </path-route>
                                        <path-route path="alice">
                                            <h4>Alice</h4>
                                            <p>Alice's Contact Info</p>
                                            <a is="route-link" for="user-contact-router" class="link-button" path="/">Back</a>
                                        </path-route>
                                        <path-route path="bob">
                                            <h4>Bob</h4>
                                            <p>Bob's Contact Info</p>
                                            <a is="route-link" for="user-contact-router" class="link-button" path="/">Back</a>
                                        </path-route>
                                    </path-router>
                                </path-route>
                            </path-router>
                        </path-route>
                        <path-route path="/help/:subpage">
                            <h2>Help</h2>
                            <nav>
                                <a is="route-link" for="help-router" data-theme="tabs" path="/faq">FAQ</a>
                                <a is="route-link" for="help-router" data-theme="tabs" path="/contact">Contact</a>
                            </nav>
                            <path-router id="help-router"data-theme="tabs">
                                <path-route path="/faq">
                                    <h3>Frequently Asked Questions</h3>
                                    <p>Answer Content</p>
                                </path-route>
                                <path-route path="/contact">
                                    <h3>Contact Us</h3>
                                    <p>Contact Content</p>
                                </path-route>
                            </path-router>
                        </path-route>
                        <dialog is="route-dialog" path="about">
                            <h2>About</h2>
                            <p>About Content</p>
                            <form method="dialog"><button method="dialog">Close</button></form>
                        </dialog>
                    </path-router>
                </div>
            </browser-mockup>
        </main>
    </div>
    <script type="module" src="./browser-mockup.js"></script>
    <script type="module" src="../dist/path-router.js"></script>
    <script type="module">
        
        this.findPart<PathRouterComponent>('app-router').addEventListener('pathchange', router_onPathChange.bind(this));
        function router_onPathChange(event)
        {
            if(!this.hasAttribute('update-url')) { return; }
            const data = event.detail;
            // console.log(data);

            const { windowPath, windowHash } = parseWindowPath();

            let { pathName: routePath, hash: routeHash } = this.findPart<PathRouterComponent>('app-router').destructurePath(data.path);
            if(routePath.startsWith('/')) { routePath = routePath.substring(1); }
            routePath = routePath.trim();
            if(routeHash.startsWith('#')) { routeHash = routeHash.substring(1); }
            routeHash = routeHash.trim();

            if(windowPath == routePath && windowHash == routeHash)
            {
                // don't update the url if we've
                // gone back to the same page
                return;
            }
            
            const newLocation = `${window.location.origin}/${routePath}${(routeHash != '') ? `#${routeHash}` : ''}${window.location.search}`;
            if(windowHash != '' && routeHash != '')
            {
                // replace the url if only the hash changes
                // otherwise back will cycle through every
                // popup instead of just closing the dialog
                window.history.replaceState(null, '', newLocation);
                return;
            }

            // console.log(newLocation);
            window.history.pushState(null, '', newLocation);
        }
    </script>
</body>
</html>