var g="route-page",c=class extends HTMLElement{get router(){return this.closest(h)}blockingBeforeOpen=[];blockingAfterOpen=[];blockingBeforeClose=[];blockingAfterClose=[];currentProcess;canBeOpened;canBeClosed;subrouting=!0;currentProperties;constructor(){super(),this.currentProcess=Promise.resolve(),this.canBeOpened=async()=>!0,this.canBeClosed=async()=>!0}async open(e){return await this.canBeOpened()?(this.currentProcess=this.#t(e),await this.currentProcess,this.currentProcess=Promise.resolve(),!0):(console.info("Navigation blocked by validity check."),!1)}async#t(e){this.currentProperties=this.getProperties(e),this.dispatchEvent(new CustomEvent("beforeopen",{detail:{path:e,properties:this.currentProperties}})),await Promise.allSettled(this.blockingBeforeOpen.map(t=>t())),this.dataset.entering="",await Promise.allSettled(this.getAnimations({subtree:!0}).map(t=>t.finished)),delete this.dataset.entering,this.toggleAttribute("open",!0),this.setAttribute("aria-current","page"),this.dispatchEvent(new Event("afteropen")),await Promise.allSettled(this.blockingAfterOpen.map(t=>t()))}async close(){return await this.canBeClosed()==!1?(console.info("Navigation blocked by validity check."),!1):(this.currentProcess=this.#e(),await this.currentProcess,this.currentProcess=Promise.resolve(),!0)}async#e(){this.dispatchEvent(new Event("beforeclose")),await Promise.allSettled(this.blockingBeforeClose.map(e=>e())),this.dataset.exiting="",this.removeAttribute("open"),await Promise.all(this.getAnimations({subtree:!0}).map(e=>e.finished)),delete this.dataset.exiting,this.removeAttribute("aria-current"),this.currentProperties=void 0,this.dispatchEvent(new Event("afterclose")),await Promise.allSettled(this.blockingAfterClose.map(e=>e()))}getProperties(e){let t=this.getAttribute("path")??"",s=(t.startsWith("/")?t.substring(1):t).split("/"),r={};if(e==null){let n=this.closest("path-router");if(n==null)return r;e=n.getAttribute("path")}if(e==null)return r;e=e??this.closest("path-router");let a=(e.startsWith("/")?e.substring(1):e).split("/");for(let n=0;n<s.length;n++){let u=s[n];if(u.startsWith(":")){let l=u.substring(1);l.endsWith("?")&&(l=l.substring(0,l.length-1)),r[l]=n<a.length?a[n]:""}}return r}applyEventListener(e,t,i){let s=this.getAttribute("open")!=null;this.addEventListener(e,t,i),(e=="beforeopen".toString()||e=="afteropen".toString())&&s==!0?this.dispatchEvent(new Event(e)):(e=="beforeclose".toString()||e=="afterclose".toString()&&s==!1)&&this.dispatchEvent(new Event(e))}addBlockingEventListener(e,t){switch(e){case"beforeopen":this.blockingBeforeOpen.push(t);break;case"afteropen":this.blockingAfterOpen.push(t);break;case"beforeclose":this.blockingBeforeClose.push(t);break;case"afterclose":this.blockingAfterClose.push(t);break}}applyBlockingEventListener(e,t){let i=this.getAttribute("open")!=null;this.addBlockingEventListener(e,t),(e=="beforeopen".toString()||e=="afteropen".toString())&&i==!0?this.dispatchEvent(new Event(e)):(e=="beforeclose".toString()||e=="afterclose".toString()&&i==!1)&&this.dispatchEvent(new Event(e))}};customElements.get(g)==null&&customElements.define(g,c);var d="route-dialog",p=class extends HTMLDialogElement{get router(){return this.closest(h)}blockingBeforeOpen=[];blockingAfterOpen=[];blockingBeforeClose=[];blockingAfterClose=[];currentProcess;canBeOpened;canBeClosed;currentProperties;constructor(){super(),this.currentProcess=Promise.resolve(),this.canBeOpened=async()=>!0,this.canBeClosed=async()=>!0}async openRoute(e){return await this.canBeOpened()?(this.currentProcess=this.#t(e),await this.currentProcess,this.currentProcess=Promise.resolve(),!0):(console.info("Navigation blocked by validity check."),!1)}async#t(e){this.currentProperties=this.getProperties(e),this.dispatchEvent(new CustomEvent("beforeopen",{detail:{path:e,properties:this.currentProperties}})),await Promise.allSettled(this.blockingBeforeOpen.map(t=>t())),this.setAttribute("data-entering",""),this.dataset.modal!=null?this.showModal():this.show(),this.setAttribute("aria-current","page"),await Promise.allSettled(this.getAnimations({subtree:!0}).map(t=>t.finished)),this.removeAttribute("data-entering"),this.dispatchEvent(new Event("afteropen")),await Promise.allSettled(this.blockingAfterOpen.map(t=>t()))}async closeRoute(){return await this.canBeClosed()==!1?(console.info("Navigation blocked by validity check."),!1):(this.currentProcess=this.#e(),await this.currentProcess,this.currentProcess=Promise.resolve(),!0)}async#e(){this.dispatchEvent(new Event("beforeclose")),await Promise.allSettled(this.blockingBeforeClose.map(e=>e())),this.setAttribute("data-exiting",""),this.close(),this.removeAttribute("aria-current"),await Promise.all(this.getAnimations({subtree:!0}).map(e=>e.finished)),this.dispatchEvent(new Event("afterclose")),await Promise.allSettled(this.blockingAfterClose.map(e=>e()))}getProperties(e){let t=this.getAttribute("path")??"",s=(t.startsWith("/")?t.substring(1):t).split("/"),o=(e.startsWith("/")?e.substring(1):e).split("/"),a={};for(let n=0;n<s.length;n++){let u=s[n];if(u.startsWith(":")){let l=u.substring(1);l.endsWith("?")&&(l=l.substring(0,l.length-1)),a[l]=n<o.length?o[n]:""}}return a}applyEventListener(e,t,i){let s=this.getAttribute("open")!=null;this.addEventListener(e,t,i),(e=="beforeopen".toString()||e=="afteropen".toString())&&s==!0?this.dispatchEvent(new Event(e)):(e=="beforeclose".toString()||e=="afterclose".toString()&&s==!1)&&this.dispatchEvent(new Event(e))}addBlockingEventListener(e,t){switch(e){case"beforeopen":this.blockingBeforeOpen.push(t);break;case"afteropen":this.blockingAfterOpen.push(t);break;case"beforeclose":this.blockingBeforeClose.push(t);break;case"afterclose":this.blockingAfterClose.push(t);break}}};customElements.get(d)==null&&customElements.define(d,p,{extends:"dialog"});var C=(t=>(t.Change="change",t.PathChange="pathchange",t))(C||{}),f=new CSSStyleSheet;f.replaceSync(`
/* 
   Animations will not be awaitable in code if they have a display of none.
   Instead, the routes are stacked in a grid.
 */
path-router
{ 
    display: var(--router-display, grid);
    grid-template-columns: 1fr;
    grid-template-rows: 1fr;
}
route-page:not([open],[data-entering],[data-exiting]) path-router { display: none; /* browser bug when rendering visibility? */ }
route-page
{
    display: var(--route-display, block);
    visibility: hidden;
    grid-row: 1;
    grid-column: 1;
}
/* 
   Visibility is visible during the entering and exiting phases
   to allow for animations to be awaited.
 */
route-page[open]
,route-page[data-entering]
,route-page[data-exiting]
{
    visibility: visible;
}
[is="route-link"]
,[is="route-button"]
{
    user-select: none;
}`);var h="path-router",m=class extends HTMLElement{get routes(){return Array.from(this.querySelectorAll(`:scope > ${g}`),e=>e)}get routeDialogs(){return Array.from(this.querySelectorAll(`:scope > [is="${d}"]`),e=>e)}targetPageRoute;currentPageRoute;targetDialogRoute;currentDialogRoute;defaultRoute;get path(){return this.getAttribute("path")}set path(e){this.setAttribute("path",e)}isInitialized=!1;#t;#e=[];#s=new Map;#r=new Map;#l=new Map;resolveNavigation;constructor(){super(),this.#t=this.#u(),this.#h()}async#u(){return new Promise(e=>{document.addEventListener("DOMContentLoaded",async()=>{for(let i=0;i<this.routes.length;i++){let s=this.routes[i];this.defaultRoute==null&&(this.defaultRoute=s),s.hasAttribute("default")==!0&&(this.defaultRoute=s)}let t=[...this.querySelectorAll("dialog")];for(let i=0;i<t.length;i++)t[i].addEventListener("close",async s=>{if(!(t[i].getAttribute("data-exiting")!=null)){let a=(this.getAttribute("path")??"/").split("#")[0];await this.navigate(a)}t[i].removeAttribute("data-exiting")});this.#s=new Map(this.routes.map(i=>[i.getAttribute("path")??"",i])),this.#r=new Map(this.routeDialogs.map(i=>[i.getAttribute("path")??"",i])),this.#l=new Map([...this.#s,...this.#r]),this.isInitialized=!0,e()})})}async#h(){if(await this.#t,!this.hasAttribute("manual"))for(let e=0;e<this.#e.length;e++)await this.#n(this.#e[e].newValue,this.#e[e].oldValue)}async navigate(e){return new Promise(t=>{this.resolveNavigation=t,this.setAttribute("path",e)})}async#n(e,t){await this.#t;let[i,s]=this.destructurePath(e),[r,o]=this.destructurePath(t),a=!1,n=!1,u=s!=""&&i==""?!1:r!=i,l=s!=o,v=this.querySelector("[open]");if(u==!1&&l==!1&&v!=null)return this.resolveNavigation!=null&&(this.resolveNavigation(),this.resolveNavigation=void 0),v.dispatchEvent(new CustomEvent("refresh",{detail:{path:e},bubbles:!0,cancelable:!0})),[a,n];await this.#g();let[R,E]=this.#c(e),b;if(u==!0||this.querySelector("[open]")==null){if(await this.#m()==!1)return console.warn("Navigation was prevented."),console.info(`Requested path: ${e}`),this.resolveNavigation!=null&&(this.resolveNavigation(),this.resolveNavigation=void 0),!1;b=this.#p(R,i)}return(u||o!=s)&&await this.#P()!=!1&&(this.targetDialogRoute=E,n=await this.#f(E,s)),await b,this.targetPageRoute=void 0,this.targetDialogRoute=void 0,this.resolveNavigation!=null&&(this.resolveNavigation(),this.resolveNavigation=void 0),this.dispatchEvent(new CustomEvent("pathchange",{detail:{path:e},bubbles:!0,cancelable:!0})),[a,n]}async#g(){return Promise.allSettled(this.routes.map(e=>e.currentProcess))}#c(e){let[t,i]=this.destructurePath(e),s=this.#i(t),r=this.#o(s,this.#s),o;if(i!=""){let a=this.#i(i);o=this.#o(a,this.#r)}return[r,o]}#i(e){return e=this.trimCharacter(e,"/"),e.split("/")}#o(e,t){let i;for(let[s,r]of t){s=this.trimCharacter(s,"/");let o=s.split("/"),{match:a,resolved:n}=this.#d(e,o);if(n!=!1){for(let u=e.length;u<o.length;u++)if(o[u].startsWith(":")==!1){a=!1;break}a==!0&&(i=r)}}return i}#d(e,t){let i=!1,s=!1;for(let r=0;r<e.length;r++){let o=t[r];if(o==null){if(s==!0)continue;return{match:!1,resolved:!1}}let a=o.startsWith(":");if(a==!1&&o!=e[r])return{match:!1,resolved:!1};i=!0,s=a}return{match:i,resolved:!0}}async#p(e,t){if(this.targetPageRoute=e,this.targetPageRoute=this.targetPageRoute||this.defaultRoute,this.targetPageRoute==null)return!1;let i=await this.targetPageRoute.open(t);return i&&(this.currentPageRoute=this.targetPageRoute,this.dispatchEvent(new CustomEvent("change",{detail:{route:this.targetPageRoute,path:t}}))),i}async#f(e,t){if(this.targetDialogRoute=e,this.targetDialogRoute==null)return!1;let i=await this.targetDialogRoute.openRoute(t);return i&&(this.currentDialogRoute=this.targetDialogRoute,this.dispatchEvent(new CustomEvent("change",{detail:{route:this.targetDialogRoute,path:t}}))),i}async#m(){if(this.currentPageRoute==null)return!0;let e=await this.currentPageRoute.close();return e==!0&&(this.currentPageRoute=void 0),e}async#P(){if(this.currentDialogRoute==null)return!0;let e=await this.currentDialogRoute.closeRoute();return e==!0&&(this.currentDialogRoute=void 0),e}#a(e){let t=e.split("#"),i=t[0],s=e.length>1?t[1]:null,r=s==null?[""]:s.split("?"),o=r==null?"":r[0];return{pathname:i,hash:o}}destructurePath(e){let{pathname:t,hash:i}=this.#a(e);if(t.trim()==""&&i!=""){let s=this.getAttribute("path")??"",{pathname:r}=this.#a(s);t=r}return[t,i]}trimCharacter(e,t){let i=new RegExp(`^\\${t}|${t}$`,"gm");return e.replace(i,"")}compareLocations(e,t){let i=!1,s=!1;return t.pathname!=e.pathname?i=!0:t.pathname==e.pathname&&t.hash!=e.hash&&(i=!0,e.hash!=""&&t.hash!=""&&(s=!0)),{hasChanged:i,isReplacementChange:s}}getRouteProperties(){let e={};if(this.currentPageRoute==null)return{};let t=this.getAttribute("path")??"/",i=this.#i(t),s=this.#i(this.currentPageRoute.getAttribute("path")??"/"),r;for(let o=0;o<s.length;o++){let a=s[o];if(a.startsWith(":")){if(r==null){let n=i[0];n.indexOf("#")>-1&&(n=n.split("#")[0]),e[this.trimCharacter(a,":")]=n;continue}for(let n=0;n<i.length-1;n++)if(i[n]==r){let l=i[n+1];l.indexOf("#")>-1&&(l=l.split("#")[0]),e[this.trimCharacter(a,":")]=l}}r=a}return e}static getUrlParameters(e){let i=new URL(e).pathname,s=i.startsWith("/")?i.substring(1):i;return this.getPathParameters(s)}static getPathParameters(e){let t=e.split("/"),i={},s=null;for(let r=0;r<t.length;r++){let o=t[r];s==null?s=o:(i[s]=o,s=null)}return i}connectedCallback(){let e=this.getRootNode();e.adoptedStyleSheets.indexOf(f)==-1&&e.adoptedStyleSheets.push(f)}static observedAttributes=["path"];attributeChangedCallback(e,t,i){e=="path"&&(this.isInitialized==!0?this.#n(i,t??""):this.#e.push({newValue:i,oldValue:t??""}))}addRouteLinkClickHandlers(e,t="a[data-route],button[data-route]"){e=e??document.body,e.addEventListener("click",i=>{let s=i.target.closest("a[data-route],button[data-route]");if(s!=null&&e.contains(s)){let r=[...e.querySelectorAll(t)];for(let a=0;a<r.length;a++)r[a].removeAttribute("aria-current");let o=s.dataset.route;this.setAttribute("path",o),s.setAttribute("aria-current","page")}})}};customElements.get(h)==null&&customElements.define(h,m);export{h as COMPONENT_TAG_NAME,m as PathRouterElement,C as PathRouterEvent,p as RouteDialogElement,c as RoutePageElement};
