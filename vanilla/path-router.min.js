var k=`/* \r
   Animations will not be awaitable in code if they have a display of none.\r
   Instead, the routes are stacked in a grid.\r
 */\r
path-router\r
{ \r
    display: var(--router-display, grid);\r
    grid-template-columns: 1fr;\r
    grid-template-rows: 1fr;\r
}\r
\r
route-page:not([open],[data-entering],[data-exiting]) path-router\r
{ display: none; /* browser bug when rendering visibility? */ }\r
\r
route-page\r
{\r
    display: var(--route-display, block);\r
    visibility: hidden;\r
    grid-row: 1;\r
    grid-column: 1;\r
}\r
/* \r
   Visibility is visible during the entering and exiting phases\r
   to allow for animations to be awaited.\r
 */\r
route-page[open]\r
,route-page[data-entering]\r
,route-page[data-exiting]\r
{\r
    visibility: visible;\r
}\r
[is="route-link"]\r
,[is="route-button"]\r
{\r
    user-select: none;\r
}`;var T=(R=HTMLElement)=>class extends R{currentProcess=Promise.resolve();canBeOpened=async()=>!0;canBeClosed=async()=>!0;getProperties(){return Object.entries(this.dataset).reduce((s,i)=>{let o=i[0];if(!o.startsWith(A))return s;let r=o[A.length].toLowerCase()+o.substring(A.length+1),n=i[1];return s[r]=n,s},{})}async enter(e){return await this.canBeOpened()?(this.currentProcess=this.#i(e),await this.currentProcess,this.currentProcess=Promise.resolve(),!0):(console.info("Navigation blocked by validity check."),!1)}async#i(e){this.dispatchEvent(new CustomEvent("beforeopen",{detail:{path:e,properties:this.getProperties()}})),await Promise.allSettled(this.#o.map(t=>t())),this.dataset.entering="",await Promise.allSettled(this.getAnimations({subtree:!0}).map(t=>t.finished)),delete this.dataset.entering,this.#t(),this.dispatchEvent(new Event("afteropen")),await Promise.allSettled(this.#r.map(t=>t()))}async#t(){this.toggleAttribute("open",!0),this.setAttribute("aria-current","page")}async exit(){return await this.canBeClosed()==!1?(console.info("Navigation blocked by validity check."),!1):(this.currentProcess=this.#e(),await this.currentProcess,this.currentProcess=Promise.resolve(),!0)}async#e(){this.dispatchEvent(new Event("beforeclose")),await Promise.allSettled(this.#a.map(e=>e())),this.dataset.exiting="",this.removeAttribute("open"),await Promise.all(this.getAnimations({subtree:!0}).map(e=>e.finished)),this.#n(),delete this.dataset.exiting,this.dispatchEvent(new Event("afterclose")),await Promise.allSettled(this.#s.map(e=>e()))}#n(){this.toggleAttribute("open",!1),this.removeAttribute("aria-current")}#o=[];#r=[];#a=[];#s=[];applyEventListener(e,t,s){let i=this.getAttribute("open")!=null;this.addEventListener(e,t,s),(e=="beforeopen".toString()||e=="afteropen".toString())&&i==!0?this.dispatchEvent(new Event(e)):(e=="beforeclose".toString()||e=="afterclose".toString()&&i==!1)&&this.dispatchEvent(new Event(e))}addBlockingEventListener(e,t){switch(e){case"beforeopen":this.#o.push(t);break;case"afteropen":this.#r.push(t);break;case"beforeclose":this.#a.push(t);break;case"afterclose":this.#s.push(t);break}}applyBlockingEventListener(e,t){let s=this.getAttribute("open")!=null;this.addBlockingEventListener(e,t),(e=="beforeopen".toString()||e=="afteropen".toString())&&s==!0?this.dispatchEvent(new Event(e)):(e=="beforeclose".toString()||e=="afterclose".toString()&&s==!1)&&this.dispatchEvent(new Event(e))}};var P="route-dialog",b=class extends T(HTMLDialogElement){};customElements.get(P)==null&&customElements.define(P,b,{extends:"dialog"});var f="route-page",w=class extends T(){};customElements.get(f)==null&&customElements.define(f,w);var N=(t=>(t.Change="change",t.PathChange="pathchange",t))(N||{}),x=new CSSStyleSheet;x.replaceSync(k);var _=new Promise(R=>document.addEventListener("DOMContentLoaded",R)),A="property",y="path-router",M=class extends HTMLElement{get routePages(){return Array.from(this.querySelectorAll(`:scope > ${f}, ${y} :not(${y}) ${f}`),e=>e)}get routeDialogs(){return Array.from(this.querySelectorAll(`:scope > [is="${P}"]`),e=>e)}get routes(){return Array.from(this.querySelectorAll(`:scope > ${f},${y} :not(${y}) ${f},:scope > [is="${P}"]`),e=>e)}targetPageRoute;currentPageRoute;targetDialogRoute;currentDialogRoute;defaultRoute;get path(){return this.getAttribute("path")}set path(e){this.setAttribute("path",e)}#i;#t=[];#e;async navigate(e){return new Promise(t=>{this.#e=t,this.setAttribute("path",e)})}addRouteLinkClickHandlers(e,t="a[data-route],button[data-route]"){e=e??document.body,e.addEventListener("click",s=>{let i=s.target.closest("a[data-route],button[data-route]");if(i!=null&&e.contains(i)){let o=[...e.querySelectorAll(t)];for(let n=0;n<o.length;n++)o[n].removeAttribute("aria-current");let r=i.dataset.route;if(r.indexOf(":")!=-1){let n=i.closest('route-page,[is="route-dialog"]');for(;n!=null;){let u=n.getProperties(),h=r.split("/").filter(g=>g.startsWith(":"));for(let g=0;g<h.length;g++){let c=h[g].substring(1);u[c]!=null&&(r=r.replace(`:${c}`,u[c]))}n=n.parentElement?.closest('route-page,[is="route-dialog"]')}}if(r.startsWith("#")){let u=(this.path??"").split("#");u[1]=r.substring(1),r=u.join("#")}this.setAttribute("path",r),i.setAttribute("aria-current","page")}})}async#n(e,t){if(this.#l==!1)throw new Error("Unable to update path-router before activation.");let[s,i]=this.#o(e),[o,r]=this.#o(t),n=!1,u=!1,h=i!=""&&s==""?!1:o!=s,g=i!=r,c=this.querySelector("[open]");if(h==!1&&g==!1&&c!=null)return this.#e!=null&&(this.#e(),this.#e=void 0),c.dispatchEvent(new CustomEvent("refresh",{detail:{path:e},bubbles:!0,cancelable:!0})),[n,u];await this.#a();let v=this.#r(e),p=v.filter(d=>d.route instanceof w),m=v.filter(d=>d.route instanceof b),E=new Promise(d=>d(!1)),C=!1,S=p.map(d=>d.route);if(h==!0||c==null){if(await this.#c(S)==!1)return console.warn("Navigation was prevented."),console.info(`Requested path: ${e}`),this.#e!=null&&(this.#e(),this.#e=void 0),!1;C=!0;for(let a=0;a<p.length;a++){let l=p[a];E=this.#s(l.route,i),this.#u(l.route,l.properties)}}if((h||r!=i)&&await this.#p(m.map(a=>a.route))!=!1){for(let a=0;a<m.length;a++){let l=m[a];if(u=await this.#g(l.route,i),this.#u(l.route,l.properties),C==!1){let D=[...l.route.querySelectorAll("route-page")];for(let O=0;O<D.length;O++)S.indexOf(D[O])>-1||await D[O].exit()}}for(let a=0;a<p.length;a++){let l=p[a];l.route.closest(`[is="${P}"][open]`)!=null&&(E=this.#s(l.route,i),this.#u(l.route,l.properties))}}return n=await E,this.targetPageRoute=void 0,this.targetDialogRoute=void 0,this.#e!=null&&(this.#e(),this.#e=void 0),this.dispatchEvent(new CustomEvent("pathchange",{detail:{path:e},bubbles:!0,cancelable:!0})),[n,u]}#o(e){let t=e.split("#"),s=t[0],i=e.length>1?t[1]:null,o=i==null?[""]:i.split("?"),r=o==null?"":o[0];return[s,r]}#r(e){let t=[],s=[];for(let i=0;i<this.routes.length;i++){let o=this.routes[i],[r,n]=this.routeMatchesPath(o,e,s,o instanceof b);r==!0&&(t.push({route:o,properties:n}),s.push(o))}return t}async#a(){return Promise.allSettled(this.routes.map(e=>e.currentProcess))}async#s(e,t){if(this.targetPageRoute=e,this.targetPageRoute=this.targetPageRoute||this.defaultRoute,this.targetPageRoute==null)return!1;let s=await this.targetPageRoute.enter(t);return s&&(this.currentPageRoute=this.targetPageRoute,this.dispatchEvent(new CustomEvent("change",{detail:{route:this.targetPageRoute,path:t}}))),s}async#g(e,t){if(this.targetDialogRoute=e,this.targetDialogRoute==null)return!1;let s=await this.targetDialogRoute.enter(t);return s&&(this.currentDialogRoute=this.targetDialogRoute,this.dispatchEvent(new CustomEvent("change",{detail:{route:this.targetDialogRoute,path:t}}))),s}async#c(e){let t=this.routePages.filter(i=>i.getAttribute("aria-current")=="page"),s=!0;for(let i=0;i<t.length;i++)e.indexOf(t[i])>-1||(s=s==!1?s:await t[i].exit());return s}async#p(e){let t=this.routeDialogs.filter(i=>i.getAttribute("aria-current")=="page"),s=!0;for(let i=0;i<t.length;i++)e.indexOf(t[i])>-1||(s=s==!1?s:await t[i].exit());return s}#u(e,t){for(let[s,i]of Object.entries(t)){let o=A+s.substring(0,1).toUpperCase()+s.substring(1);e.dataset[o]=i}}routeMatchesPath(e,t,s,i=!1){let o=t.split("#"),r=o[0],n=o.length>1?o[1]:null,h=(e.getAttribute("path")??"").split("/"),g=r.split("/");if((e.closest(`[is="${P}"]`)==null?"Page":"Dialog")=="Page")return this.routeTypeMatches(e,g,h,`${f}`,s);if(n==null)return[!1,{}];let v=n.split("/");return this.routeTypeMatches(e,v,h,`${f},[is="${P}"]`,s)}routeTypeMatches(e,t,s,i,o){if(t.length==1&&t[0].trim()=="")return[!1,{}];let r=[],n=e.parentElement?.closest(i);for(;n!=null;){if(o.indexOf(n)==-1)return[!1,{}];r.push(n),n=n.parentElement?.closest(i)}let h=r.reverse().reduce((p,m,E)=>`${p==""?"":p+"/"}${m.getAttribute("path")??""}`,"").split("/"),g=[...t].filter((p,m)=>{let E=h[m];return!(E?.startsWith(":")==!0||E==p)}),{match:c,properties:v}=this.pathArraySelectsRouteArray(g,s);return[c,v]}getRouteProperties(e){if(e!=null)return e.getProperties();let t={};for(let s=0;s<this.routes.length;s++){let i=this.routes[s];Object.assign(t,i.getProperties())}return t}pathArraySelectsRouteArray(e,t){let s={};if(t.length>e.length)return{match:!1,properties:s};let i=!1;for(let o=0;o<e.length;o++){let r=t[o],n=e[o];if(r==null)return{match:i,properties:s};if(r.startsWith(":")==!1){if(r!=n)return{match:!1,properties:s}}else s[r.substring(1)]=n;i=!0}return{match:i,properties:s}}async connectedCallback(){this.#i=this.#d(),this.#y(),await this.#i,await this.#P(),this.currentPageRoute==null&&this.defaultRoute!=null&&this.#s(this.defaultRoute,"")}disconnectedCallback(){this.#R()}#l=!1;async#d(){await _,this.#f(),this.#m(),this.#l=!0}#f(){this.defaultRoute=this.querySelector("route-page[default]"),this.defaultRoute==null&&(this.defaultRoute=this.querySelector("route-page"))}async#P(){for(let e=0;e<this.#t.length;e++)await this.#n(this.#t[e].newValue,this.#t[e].oldValue)}#h=this.#E.bind(this);#m(){for(let e=0;e<this.routeDialogs.length;e++)this.routeDialogs[e].addEventListener("close",this.#h)}async#E(e){let t=e.target;if(!(t.getAttribute("data-exiting")!=null)){let o=(this.getAttribute("path")??"/").split("#")[0];await this.navigate(o)}t.removeAttribute("data-exiting")}#R(){this.#v(),this.#b(),this.#i=void 0,this.#l=!1}#v(){this.defaultRoute!=null&&(this.defaultRoute=void 0)}#b(){this.removeEventListener("close",this.#h)}#y(){let e=this.getRootNode();e.adoptedStyleSheets.indexOf(x)==-1&&e.adoptedStyleSheets.push(x)}static observedAttributes=["path"];attributeChangedCallback(e,t,s){e=="path"&&(this.#l==!0?this.#n(s,t??""):this.#t.push({newValue:s,oldValue:t??""}))}};customElements.get(y)==null&&customElements.define(y,M);export{y as COMPONENT_TAG_NAME,M as PathRouterElement,N as PathRouterEvent,A as ROUTEPROPERTY_DATA_ATTRIBUTE_KEYWORD};
