var k=`/* \r
   Animations will not be awaitable in code if they have a display of none.\r
   Instead, the routes are stacked in a grid.\r
 */\r
path-router\r
{ \r
    display: var(--router-display, grid);\r
    grid-template-columns: 1fr;\r
    grid-template-rows: 1fr;\r
}\r
\r
route-page:not([open],[data-entering],[data-exiting]) path-router\r
{ display: none; /* browser bug when rendering visibility? */ }\r
\r
route-page\r
{\r
    display: var(--route-display, block);\r
    visibility: hidden;\r
    grid-row: 1;\r
    grid-column: 1;\r
}\r
/* \r
   Visibility is visible during the entering and exiting phases\r
   to allow for animations to be awaited.\r
 */\r
route-page[open]\r
,route-page[data-entering]\r
,route-page[data-exiting]\r
{\r
    visibility: visible;\r
}\r
[is="route-link"]\r
,[is="route-button"]\r
{\r
    user-select: none;\r
}`;var T=(R=HTMLElement)=>class extends R{currentProcess=Promise.resolve();canBeOpened=async()=>!0;canBeClosed=async()=>!0;getProperties(){return Object.entries(this.dataset).reduce((o,s)=>{let i=s[0];if(!i.startsWith(A))return o;let n=i[A.length].toLowerCase()+i.substring(A.length+1),r=s[1];return o[n]=r,o},{})}async enter(t){return await this.canBeOpened()?(this.currentProcess=this.#s(t),await this.currentProcess,this.currentProcess=Promise.resolve(),!0):(console.info("Navigation blocked by validity check."),!1)}async#s(t){this.dispatchEvent(new CustomEvent("beforeopen",{detail:{path:t,properties:this.getProperties()}})),await Promise.allSettled(this.#o.map(e=>e())),this.dataset.entering="",await Promise.allSettled(this.getAnimations({subtree:!0}).map(e=>e.finished)),delete this.dataset.entering,this.#e(),this.dispatchEvent(new Event("afteropen")),await Promise.allSettled(this.#r.map(e=>e()))}async#e(){this.toggleAttribute("open",!0),this.setAttribute("aria-current","page")}async exit(){return await this.canBeClosed()==!1?(console.info("Navigation blocked by validity check."),!1):(this.currentProcess=this.#t(),await this.currentProcess,this.currentProcess=Promise.resolve(),!0)}async#t(){this.dispatchEvent(new Event("beforeclose")),await Promise.allSettled(this.#n.map(t=>t())),this.dataset.exiting="",this.removeAttribute("open"),await Promise.all(this.getAnimations({subtree:!0}).map(t=>t.finished)),this.#i(),delete this.dataset.exiting,this.dispatchEvent(new Event("afterclose")),await Promise.allSettled(this.#a.map(t=>t()))}#i(){this.toggleAttribute("open",!1),this.removeAttribute("aria-current")}#o=[];#r=[];#n=[];#a=[];applyEventListener(t,e,o){let s=this.getAttribute("open")!=null;this.addEventListener(t,e,o),(t=="beforeopen".toString()||t=="afteropen".toString())&&s==!0?this.dispatchEvent(new Event(t)):(t=="beforeclose".toString()||t=="afterclose".toString()&&s==!1)&&this.dispatchEvent(new Event(t))}addBlockingEventListener(t,e){switch(t){case"beforeopen":this.#o.push(e);break;case"afteropen":this.#r.push(e);break;case"beforeclose":this.#n.push(e);break;case"afterclose":this.#a.push(e);break}}applyBlockingEventListener(t,e){let o=this.getAttribute("open")!=null;this.addBlockingEventListener(t,e),(t=="beforeopen".toString()||t=="afteropen".toString())&&o==!0?this.dispatchEvent(new Event(t)):(t=="beforeclose".toString()||t=="afterclose".toString()&&o==!1)&&this.dispatchEvent(new Event(t))}};var P="route-dialog",b=class extends T(HTMLDialogElement){};customElements.get(P)==null&&customElements.define(P,b,{extends:"dialog"});var f="route-page",w=class extends T(){};customElements.get(f)==null&&customElements.define(f,w);var N=(e=>(e.Change="change",e.PathChange="pathchange",e))(N||{}),M=new CSSStyleSheet;M.replaceSync(k);var _=new Promise(R=>document.addEventListener("DOMContentLoaded",R)),A="property",y="path-router",x=class extends HTMLElement{get routePages(){return Array.from(this.querySelectorAll(`:scope > ${f}, ${y} :not(${y}) ${f}`),t=>t)}get routeDialogs(){return Array.from(this.querySelectorAll(`:scope > [is="${P}"]`),t=>t)}get routes(){return Array.from(this.querySelectorAll(`:scope > ${f},${y} :not(${y}) ${f},:scope > [is="${P}"]`),t=>t)}targetPageRoute;currentPageRoute;targetDialogRoute;currentDialogRoute;defaultRoute;get path(){return this.getAttribute("path")}set path(t){this.setAttribute("path",t)}#s;#e=[];#t;async navigate(t){return new Promise(e=>{this.#t=e,this.setAttribute("path",t)})}addRouteLinkClickHandlers(t,e="a[data-route],button[data-route]"){t=t??document.body,t.addEventListener("click",o=>{let s=o.target.closest("a[data-route],button[data-route]");if(s!=null&&t.contains(s)){let i=[...t.querySelectorAll(e)];for(let r=0;r<i.length;r++)i[r].removeAttribute("aria-current");let n=s.dataset.route;if(n.indexOf(":")!=-1){let r=s.closest('route-page,[is="route-dialog"]');for(;r!=null;){let a=r.getProperties(),c=n.split("/").filter(l=>l.startsWith(":"));for(let l=0;l<c.length;l++){let p=c[l].substring(1);a[p]!=null&&(n=n.replace(`:${p}`,a[p]))}r=r.parentElement?.closest('route-page,[is="route-dialog"]')}}if(n.startsWith("#")){let a=(this.path??"").split("#");a[1]=n.substring(1),n=a.join("#")}this.setAttribute("path",n),s.setAttribute("aria-current","page")}})}async#i(t,e){if(this.#l==!1)throw new Error("Unable to update path-router before activation.");let[o,s]=this.#o(t),[i,n]=this.#o(e),r=!1,a=!1,c=s!=""&&o==""?!1:i!=o,l=s!=n,p=this.querySelector("[open]");if(c==!1&&l==!1&&p!=null)return this.#t!=null&&(this.#t(),this.#t=void 0),p.dispatchEvent(new CustomEvent("refresh",{detail:{path:t},bubbles:!0,cancelable:!0})),[r,a];await this.#a();let v=this.#r(t),g=v.filter(d=>d.route instanceof w),m=v.filter(d=>d.route instanceof b),E=new Promise(d=>d(!1));g=this.#n(g);let C=!1,S=g.map(d=>d.route);if(c==!0||p==null){if(await this.#p(S)==!1)return console.warn("Navigation was prevented."),console.info(`Requested path: ${t}`),this.#t!=null&&(this.#t(),this.#t=void 0),!1;C=!0;for(let u=0;u<g.length;u++){let h=g[u];E=this.#u(h.route,s),this.#h(h.route,h.properties)}}if((c||n!=s)&&await this.#d(m.map(u=>u.route))!=!1){for(let u=0;u<m.length;u++){let h=m[u];if(a=await this.#g(h.route,s),this.#h(h.route,h.properties),C==!1){let D=[...h.route.querySelectorAll("route-page")];for(let O=0;O<D.length;O++)S.indexOf(D[O])>-1||await D[O].exit()}}for(let u=0;u<g.length;u++){let h=g[u];h.route.closest(`[is="${P}"][open]`)!=null&&(E=this.#u(h.route,s),this.#h(h.route,h.properties))}}return r=await E,this.targetPageRoute=void 0,this.targetDialogRoute=void 0,this.#t!=null&&(this.#t(),this.#t=void 0),this.dispatchEvent(new CustomEvent("pathchange",{detail:{path:t},bubbles:!0,cancelable:!0})),[r,a]}#o(t){let e=t.split("#"),o=e[0],s=t.length>1?e[1]:null,i=s==null?[""]:s.split("?"),n=i==null?"":i[0];return[o,n]}#r(t){let e=[],o=[];for(let s=0;s<this.routes.length;s++){let i=this.routes[s],[n,r]=this.routeMatchesPath(i,t,o,i instanceof b);n==!0&&(e.push({route:i,properties:r}),o.push(i))}return e}#n(t){let e=[];for(let s=0;s<t.length;s++){let i=t[s],n=i.route.getAttribute("path"),r=i.route.parentElement?.closest('route-page,[is="route-dialog"],path-router'),a=t.find(l=>e.indexOf(l)==-1&&l!=i&&l.route.parentElement?.closest('route-page,[is="route-dialog"],path-router')==r);if(a==null)continue;if(n?.startsWith(":")){e.push(i);continue}a.route.getAttribute("path")?.startsWith(":")&&e.push(a)}return t.filter(s=>e.indexOf(s)==-1)}async#a(){return Promise.allSettled(this.routes.map(t=>t.currentProcess))}async#u(t,e){if(this.targetPageRoute=t,this.targetPageRoute=this.targetPageRoute||this.defaultRoute,this.targetPageRoute==null)return!1;let o=await this.targetPageRoute.enter(e);return o&&(this.currentPageRoute=this.targetPageRoute,this.dispatchEvent(new CustomEvent("change",{detail:{route:this.targetPageRoute,path:e}}))),o}async#g(t,e){if(this.targetDialogRoute=t,this.targetDialogRoute==null)return!1;let o=await this.targetDialogRoute.enter(e);return o&&(this.currentDialogRoute=this.targetDialogRoute,this.dispatchEvent(new CustomEvent("change",{detail:{route:this.targetDialogRoute,path:e}}))),o}async#p(t){let e=this.routePages.filter(s=>s.getAttribute("aria-current")=="page"),o=!0;for(let s=0;s<e.length;s++)t.indexOf(e[s])>-1||(o=o==!1?o:await e[s].exit());return o}async#d(t){let e=this.routeDialogs.filter(s=>s.getAttribute("aria-current")=="page"),o=!0;for(let s=0;s<e.length;s++)t.indexOf(e[s])>-1||(o=o==!1?o:await e[s].exit());return o}#h(t,e){for(let[o,s]of Object.entries(e)){let i=A+o.substring(0,1).toUpperCase()+o.substring(1);t.dataset[i]=s}}routeMatchesPath(t,e,o,s=!1){let i=e.split("#"),n=i[0],r=i.length>1?i[1]:null,c=(t.getAttribute("path")??"").split("/"),l=n.split("/");if((t.closest(`[is="${P}"]`)==null?"Page":"Dialog")=="Page")return this.routeTypeMatches(t,l,c,`${f}`,o);if(r==null)return[!1,{}];let v=r.split("/");return this.routeTypeMatches(t,v,c,`${f},[is="${P}"]`,o)}routeTypeMatches(t,e,o,s,i){if(e.length==1&&e[0].trim()=="")return[!1,{}];let n=[],r=t.parentElement?.closest(s);for(;r!=null;){if(i.indexOf(r)==-1)return[!1,{}];n.push(r),r=r.parentElement?.closest(s)}let c=n.reverse().reduce((g,m,E)=>`${g==""?"":g+"/"}${m.getAttribute("path")??""}`,"").split("/"),l=[...e].filter((g,m)=>{let E=c[m];return!(E?.startsWith(":")==!0||E==g)}),{match:p,properties:v}=this.pathArraySelectsRouteArray(l,o);return[p,v]}getRouteProperties(t){if(t!=null)return t.getProperties();let e={};for(let o=0;o<this.routes.length;o++){let s=this.routes[o];Object.assign(e,s.getProperties())}return e}pathArraySelectsRouteArray(t,e){let o={};if(e.length>t.length)return{match:!1,properties:o};let s=!1;for(let i=0;i<t.length;i++){let n=e[i],r=t[i];if(n==null)return{match:s,properties:o};if(n.startsWith(":")==!1){if(n!=r)return{match:!1,properties:o}}else o[n.substring(1)]=r;s=!0}return{match:s,properties:o}}async connectedCallback(){this.#s=this.#f(),this.#A(),await this.#s,await this.#m(),this.currentPageRoute==null&&this.defaultRoute!=null&&this.#u(this.defaultRoute,"")}disconnectedCallback(){this.#v()}#l=!1;async#f(){await _,this.#P(),this.#E(),this.#l=!0}#P(){this.defaultRoute=this.querySelector("route-page[default]"),this.defaultRoute==null&&(this.defaultRoute=this.querySelector("route-page"))}async#m(){for(let t=0;t<this.#e.length;t++)await this.#i(this.#e[t].newValue,this.#e[t].oldValue)}#c=this.#R.bind(this);#E(){for(let t=0;t<this.routeDialogs.length;t++)this.routeDialogs[t].addEventListener("close",this.#c)}async#R(t){let e=t.target;if(!(e.getAttribute("data-exiting")!=null)){let i=(this.getAttribute("path")??"/").split("#")[0];await this.navigate(i)}e.removeAttribute("data-exiting")}#v(){this.#b(),this.#y(),this.#s=void 0,this.#l=!1}#b(){this.defaultRoute!=null&&(this.defaultRoute=void 0)}#y(){this.removeEventListener("close",this.#c)}#A(){let t=this.getRootNode();t.adoptedStyleSheets.indexOf(M)==-1&&t.adoptedStyleSheets.push(M)}static observedAttributes=["path"];attributeChangedCallback(t,e,o){t=="path"&&(this.#l==!0?this.#i(o,e??""):this.#e.push({newValue:o,oldValue:e??""}))}};customElements.get(y)==null&&customElements.define(y,x);export{y as COMPONENT_TAG_NAME,x as PathRouterElement,N as PathRouterEvent,A as ROUTEPROPERTY_DATA_ATTRIBUTE_KEYWORD};
