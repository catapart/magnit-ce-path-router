var m="route-page",A=class extends HTMLElement{get router(){return this.closest(p)}blockingBeforeOpen=[];blockingAfterOpen=[];blockingBeforeClose=[];blockingAfterClose=[];currentProcess;canBeOpened;canBeClosed;subrouting=!0;currentProperties;constructor(){super(),this.currentProcess=Promise.resolve(),this.canBeOpened=async()=>!0,this.canBeClosed=async()=>!0}async open(t){return await this.canBeOpened()?(this.currentProcess=this.#t(t),await this.currentProcess,this.currentProcess=Promise.resolve(),!0):(console.info("Navigation blocked by validity check."),!1)}async#t(t){if(this.dispatchEvent(new CustomEvent("beforeopen",{detail:{path:t,properties:this.currentProperties}})),await Promise.allSettled(this.blockingBeforeOpen.map(s=>s())),this.dataset.entering="",this.currentProperties=this.getProperties(t),(this.getAttribute("subrouting")??this.closest("path-router[subrouting]")?.getAttribute("subrouting"))!="false"==!0){let s=this.querySelector(":scope > path-router");if(s!=null){let r=this.extractSubroute(t);await s.subnavigate(r)}}await Promise.allSettled(this.getAnimations({subtree:!0}).map(s=>s.finished)),delete this.dataset.entering,this.toggleAttribute("open",!0),this.setAttribute("aria-current","page"),this.dispatchEvent(new Event("afteropen")),await Promise.allSettled(this.blockingAfterOpen.map(s=>s()))}async close(){return await this.canBeClosed()==!1?(console.info("Navigation blocked by validity check."),!1):(this.currentProcess=this.#e(),await this.currentProcess,this.currentProcess=Promise.resolve(),!0)}async#e(){this.dispatchEvent(new Event("beforeclose")),await Promise.allSettled(this.blockingBeforeClose.map(t=>t())),this.dataset.exiting="",this.removeAttribute("open"),await Promise.all(this.getAnimations({subtree:!0}).map(t=>t.finished)),delete this.dataset.exiting,this.removeAttribute("aria-current"),this.currentProperties=void 0,this.dispatchEvent(new Event("afterclose")),await Promise.allSettled(this.blockingAfterClose.map(t=>t()))}getProperties(t){let e=this.getAttribute("path")??"",r=(e.startsWith("/")?e.substring(1):e).split("/"),i=(t.startsWith("/")?t.substring(1):t).split("/"),u={};for(let a=0;a<r.length;a++){let n=r[a];if(n.startsWith(":")){let l=n.substring(1);l.endsWith("?")&&(l=l.substring(0,l.length-1)),u[l]=a<i.length?i[a]:""}}return u}extractSubroute(t){let e=this.getAttribute("path")??"",r=(e.startsWith("/")?e.substring(1):e).split("/"),i=(t.startsWith("/")?t.substring(1):t).split("/"),u=r.findLastIndex(n=>!n.startsWith(":"))+1;return i.slice(u).join("/")}applyEventListener(t,e,s){let r=this.getAttribute("open")!=null;this.addEventListener(t,e,s),(t=="beforeopen".toString()||t=="afteropen".toString())&&r==!0?this.dispatchEvent(new Event(t)):(t=="beforeclose".toString()||t=="afterclose".toString()&&r==!1)&&this.dispatchEvent(new Event(t))}addBlockingEventListener(t,e){switch(t){case"beforeopen":this.blockingBeforeOpen.push(e);break;case"afteropen":this.blockingAfterOpen.push(e);break;case"beforeclose":this.blockingBeforeClose.push(e);break;case"afterclose":this.blockingAfterClose.push(e);break}}applyBlockingEventListener(t,e){let s=this.getAttribute("open")!=null;this.addBlockingEventListener(t,e),(t=="beforeopen".toString()||t=="afteropen".toString())&&s==!0?this.dispatchEvent(new Event(t)):(t=="beforeclose".toString()||t=="afterclose".toString()&&s==!1)&&this.dispatchEvent(new Event(t))}};customElements.get(m)==null&&customElements.define(m,A);var v="route-dialog",E=class extends HTMLDialogElement{get router(){return this.closest(p)}blockingBeforeOpen=[];blockingAfterOpen=[];blockingBeforeClose=[];blockingAfterClose=[];currentProcess;canBeOpened;canBeClosed;currentProperties;constructor(){super(),this.currentProcess=Promise.resolve(),this.canBeOpened=async()=>!0,this.canBeClosed=async()=>!0}async openRoute(t){return await this.canBeOpened()?(this.currentProcess=this.#t(t),await this.currentProcess,this.currentProcess=Promise.resolve(),!0):(console.info("Navigation blocked by validity check."),!1)}async#t(t){if(this.dispatchEvent(new CustomEvent("beforeopen",{detail:{path:t,properties:this.currentProperties}})),await Promise.allSettled(this.blockingBeforeOpen.map(s=>s())),this.setAttribute("data-entering",""),this.currentProperties=this.getProperties(t),(this.getAttribute("subrouting")??this.closest("path-router[subrouting]")?.getAttribute("subrouting"))!="false"==!0){let s=this.querySelector(":scope > path-router");if(s!=null){let r=this.extractSubroute(t);await s.subnavigate(r)}}this.dataset.modal!=null?this.showModal():this.show(),this.setAttribute("aria-current","page"),await Promise.allSettled(this.getAnimations({subtree:!0}).map(s=>s.finished)),this.removeAttribute("data-entering"),this.dispatchEvent(new Event("afteropen")),await Promise.allSettled(this.blockingAfterOpen.map(s=>s()))}async closeRoute(){return await this.canBeClosed()==!1?(console.info("Navigation blocked by validity check."),!1):(this.currentProcess=this.#e(),await this.currentProcess,this.currentProcess=Promise.resolve(),!0)}async#e(){this.dispatchEvent(new Event("beforeclose")),await Promise.allSettled(this.blockingBeforeClose.map(t=>t())),this.setAttribute("data-exiting",""),this.close(),this.removeAttribute("aria-current"),await Promise.all(this.getAnimations({subtree:!0}).map(t=>t.finished)),this.dispatchEvent(new Event("afterclose")),await Promise.allSettled(this.blockingAfterClose.map(t=>t()))}getProperties(t){let e=this.getAttribute("path")??"",r=(e.startsWith("/")?e.substring(1):e).split("/"),i=(t.startsWith("/")?t.substring(1):t).split("/"),u={};for(let a=0;a<r.length;a++){let n=r[a];if(n.startsWith(":")){let l=n.substring(1);l.endsWith("?")&&(l=l.substring(0,l.length-1)),u[l]=a<i.length?i[a]:""}}return u}extractSubroute(t){let e=this.getAttribute("path")??"",r=(e.startsWith("/")?e.substring(1):e).split("/"),i=(t.startsWith("/")?t.substring(1):t).split("/"),u=r.findLastIndex(n=>!n.startsWith(":"))+1;return i.slice(u).join("/")}applyEventListener(t,e,s){let r=this.getAttribute("open")!=null;this.addEventListener(t,e,s),(t=="beforeopen".toString()||t=="afteropen".toString())&&r==!0?this.dispatchEvent(new Event(t)):(t=="beforeclose".toString()||t=="afterclose".toString()&&r==!1)&&this.dispatchEvent(new Event(t))}addBlockingEventListener(t,e){switch(t){case"beforeopen":this.blockingBeforeOpen.push(e);break;case"afteropen":this.blockingAfterOpen.push(e);break;case"beforeclose":this.blockingBeforeClose.push(e);break;case"afterclose":this.blockingAfterClose.push(e);break}}};customElements.get(v)==null&&customElements.define(v,E,{extends:"dialog"});var M="route-link",C=class extends HTMLAnchorElement{constructor(){super()}connectedCallback(){let t=this.#t();t!=null?(t.addEventListener("pathchange",this.#s.bind(this)),this.addEventListener("click",this.onClick.bind(this,t))):console.warn("No path router found. Clicking this button will have no navigation effect")}onClick(t){let e=this.getAttribute("path")??this.getAttribute("data-path")??"";e=this.#e(),t.navigate(e)}#t(){let t=this.getAttribute("for"),e=this.getAttribute("target"),s=t!=null?`#${t}`:e??"path-router";return this.getRootNode().querySelector(s)}#e(){let t=this.getAttribute("path")??this.getAttribute("data-path")??"";return t=this.onPreparePath(t),t}onPreparePath(t){return t}#s(t){let e=this.getAttribute("path");if(e==null){console.log("link");return}let s=this.#t();if(s==null){console.log("target");return}s.pathIsActive(e)?this.setAttribute("aria-current","page"):this.removeAttribute("aria-current")}};customElements.get(M)==null&&customElements.define(M,C,{extends:"a"});var T="route-button",y=class extends HTMLButtonElement{constructor(){super()}connectedCallback(){let t=this.#t();t!=null?(t.addEventListener("pathchange",this.#e.bind(this)),this.addEventListener("click",this.onClick.bind(this,t))):console.warn("No path router found. Clicking this button will have no navigation effect")}onClick(t){let e=this.getAttribute("path")??this.getAttribute("data-path")??"";e=this.#s(),t.navigate(e)}#t(){let t=this.getAttribute("for"),e=this.getAttribute("target"),s=t!=null?`#${t}`:e??"path-router";return this.getRootNode().querySelector(s)}#e(){let t=this.getAttribute("path");if(t==null)return;let e=this.#t();if(e==null)return;e.pathIsActive(t)?this.setAttribute("aria-current","page"):this.removeAttribute("aria-current")}#s(){let t=this.getAttribute("path")??this.getAttribute("data-path")??"";return t=this.onPreparePath(t),t}onPreparePath(t){return t}};customElements.get(T)==null&&customElements.define(T,y,{extends:"button"});var w=(s=>(s.Change="change",s.PathChange="pathchange",s.PathCompose="pathcompose",s))(w||{}),O=new CSSStyleSheet;O.replaceSync(`
/* 
   Animations will not be awaitable in code if they have a display of none.
   Instead, the routes are stacked in a grid.
 */
path-router
{ 
    display: var(--router-display, grid);
    grid-template-columns: 1fr;
    grid-template-rows: 1fr;
}
route-page:not([open],[data-entering],[data-exiting]) path-router { display: none; /* browser bug when rendering visibility? */ }
route-page
{
    display: var(--route-display, block);
    visibility: hidden;
    grid-row: 1;
    grid-column: 1;
}
/* 
   Visibility is visible during the entering and exiting phases
   to allow for animations to be awaited.
 */
route-page[open]
,route-page[data-entering]
,route-page[data-exiting]
{
    visibility: visible;
}`);var B="*",p="path-router",k=class extends HTMLElement{get routes(){return Array.from(this.querySelectorAll(`:scope > ${m}`),t=>t)}get routeDialogs(){return Array.from(this.querySelectorAll(`:scope > [is="${v}"]`),t=>t)}targetPageRoute;currentPageRoute;targetDialogRoute;currentDialogRoute;defaultRoute;wildcardRoute;get path(){return this.getAttribute("path")}set path(t){this.setAttribute("path",t)}subpaths=[];subrouting=!0;isInitialized=!1;#t;#e=[];#s=new Map;#r=new Map;#a=new Map;resolveNavigation;constructor(){super(),this.addEventListener("pathchange",t=>{t.target!=this&&this.#l()}),this.#t=this.#h(),this.#c()}async#h(){return new Promise(t=>{document.addEventListener("DOMContentLoaded",async()=>{for(let r=0;r<this.routes.length;r++){let o=this.routes[r];this.defaultRoute==null&&(this.defaultRoute=o);let i=o.getAttribute("path"),u=o.hasAttribute("default");i!=null&&i.trim()=="*"&&(this.wildcardRoute=o),u==!0&&(this.defaultRoute=o)}let e=[...this.querySelectorAll("dialog")];for(let r=0;r<e.length;r++)e[r].addEventListener("close",async o=>{if(!(e[r].getAttribute("data-exiting")!=null)){let a=(this.getAttribute("path")??"/").split("#")[0];await this.navigate(a)}e[r].removeAttribute("data-exiting")});let s=[...this.querySelectorAll("path-router")];for(let r=0;r<s.length;r++)s[r].toggleAttribute("subrouter",!0);this.#s=new Map(this.routes.map(r=>[r.getAttribute("path")??"",r])),this.#r=new Map(this.routeDialogs.map(r=>[r.getAttribute("path")??"",r])),this.#a=new Map([...this.#s,...this.#r]),this.isInitialized=!0,t()})})}async#c(){if(await this.#t,!this.hasAttribute("manual"))for(let t=0;t<this.#e.length;t++)await this.#u(this.#e[t].newValue,this.#e[t].oldValue)}async navigate(t){return new Promise(e=>{this.resolveNavigation=e,this.setAttribute("path",t)})}async subnavigate(t){return this.toggleAttribute("subnavigating",!0),this.navigate(t)}async#u(t,e){await this.#t;let[s,r]=this.destructurePath(t),[o,i]=this.destructurePath(e),u=!1,a=!1,n=o!=s,l=r!=i;if(n==!1&&l==!1&&this.querySelector("[open]")!=null)return this.resolveNavigation!=null&&(this.resolveNavigation(),this.resolveNavigation=void 0),[u,a];await this.#g();let[h,c]=this.#p(t),R;if(n==!0||this.querySelector("[open]")==null){if(await this.#b()==!1)return console.warn("Navigation was prevented."),console.info(`Requested path: ${t}`),this.resolveNavigation!=null&&(this.resolveNavigation(),this.resolveNavigation=void 0),!1;R=this.#f(h,s)}return(n||i!=r)&&await this.#m()!=!1&&(this.targetDialogRoute=c,a=await this.#P(c,r)),await R,this.targetPageRoute=void 0,this.targetDialogRoute=void 0,this.resolveNavigation!=null&&(this.resolveNavigation(),this.resolveNavigation=void 0),this.#l(),this.removeAttribute("subnavigating"),this.dispatchEvent(new CustomEvent("pathchange",{detail:{path:t,supaths:this.subpaths},bubbles:!0,cancelable:!0})),[u,a]}async#l(){let t=this.getAttribute("composedPath"),e=this.composeRoutePath();this.setAttribute("composed-path",e),this.getAttribute("subrouter")==null&&this.dispatchEvent(new CustomEvent("pathcompose",{detail:{composedPath:e,previousComposedPath:t},bubbles:!0,cancelable:!0}))}async#g(){return Promise.allSettled(this.routes.map(t=>t.currentProcess))}#p(t){let[e,s]=this.destructurePath(t),r=this.#i(e),o=this.#o(r,this.#s),i;if(s!=""){let u=this.#i(s);i=this.#o(u,this.#r)}return[o,i]}#i(t){return t=this.trimCharacter(t,"/"),t.split("/")}#o(t,e){let s;for(let[r,o]of e){r=this.trimCharacter(r,"/");let i=r.split("/"),{match:u,resolved:a}=this.#d(t,i);if(a!=!1){for(let n=t.length;n<i.length;n++)if(i[n].startsWith(":")==!1){u=!1;break}u==!0&&(s=o)}}return s}#d(t,e){let s=!1,r=!1;for(let o=0;o<t.length;o++){let i=e[o];if(i==null){if(r==!0)continue;return{match:!1,resolved:!1}}let u=i.startsWith(":");if(u==!1&&i!=B&&i!=t[o])return{match:!1,resolved:!1};s=!0,r=u}return{match:s,resolved:!0}}async#f(t,e){if(this.targetPageRoute=t,this.targetPageRoute==null&&this.wildcardRoute!=null&&(this.targetPageRoute=this.wildcardRoute),this.targetPageRoute=this.targetPageRoute||this.defaultRoute,this.targetPageRoute==null)return!1;let s=await this.targetPageRoute.open(e);return s&&(this.currentPageRoute=this.targetPageRoute,this.dispatchEvent(new CustomEvent("change",{detail:{route:this.targetPageRoute,path:e}}))),s}async#P(t,e){if(this.targetDialogRoute=t,this.targetDialogRoute==null)return!1;let s=await this.targetDialogRoute.openRoute(e);return s&&(this.currentDialogRoute=this.targetDialogRoute,this.dispatchEvent(new CustomEvent("change",{detail:{route:this.targetDialogRoute,path:e}}))),s}async#b(){if(this.currentPageRoute==null)return!0;let t=await this.currentPageRoute.close();return t==!0&&(this.currentPageRoute=void 0),t}async#m(){if(this.currentDialogRoute==null)return!0;let t=await this.currentDialogRoute.closeRoute();return t==!0&&(this.currentDialogRoute=void 0),t}#n(t){let e=t.split("#"),s=e[0],r=t.length>1?e[1]:null,o=r==null?[""]:r.split("?"),i=o==null?"":o[0];return{pathname:s,hash:i}}destructurePath(t){let{pathname:e,hash:s}=this.#n(t);if(e.trim()==""&&s!=""){let r=this.getAttribute("path")??"",{pathname:o}=this.#n(r);e=o}return[e,s]}trimCharacter(t,e){let s=new RegExp(`^\\${e}|${e}$`,"gm");return t.replace(s,"")}composeRoutePath(){let t=this.getAttribute("path")??"",[e,s]=this.destructurePath(t),r=new f;r.path=e,r.hash=s;let o=this.targetPageRoute??this.currentPageRoute;o!=null&&(r=this.#v(o,r));let i=this.targetDialogRoute??this.currentDialogRoute;return i!=null&&(r.isDialogRoute=!1,r=this.#R(i,r)),this.#A(r.path,r.hash,r.subroutePath,r.subrouteHash,r.properties)}#v(t,e=new f){if(t!=null){Object.assign(e.properties,t.currentProperties);let s=t.getAttribute("path")??"",[r,o]=this.destructurePath(s);e.path=r??e.path,e.hash=o.trim()==""?e.hash:o;let i=t.querySelector("path-router");if(i!=null){let u=i.composeRoutePath(),a="";[e.subroutePath,a]=this.destructurePath(u),e.isDialogRoute==!0&&(e.subrouteHash=a);let n=i.targetPageRoute??i.currentPageRoute;n!=null&&Object.assign(e.properties,n.currentProperties)}}return e}#R(t,e=new f){if(t!=null){Object.assign(e.properties,t.currentProperties);let s=t.querySelector("path-router");if(s!=null){let r=s.composeRoutePath(),[o]=this.destructurePath(r),i=s.targetPageRoute??s.currentPageRoute;i!=null&&Object.assign(e.properties,i.currentProperties),o=t.getAttribute("path").replace(/:[\s\S]*/gm,o),o=this.trimCharacter(o,"/");let a=o.split("/"),n=e.hash.split("/");for(let l=0;l<a.length;l++)a[l]!=n[l]&&(n[l]!=null?n[l]=a[l]:n.push(a[l]));e.hash=n.join("/")}}return e}#A(t,e,s,r,o){let i=t.split("/"),u=s.split("/"),a=i[i.length-1].startsWith(":"),n=e.split("/"),l=r.split("/"),h=n[n.length-1].startsWith(":");for(let[g,b]of Object.entries(o)){let S=i.indexOf(`:${g}`);S>-1&&(i[S]=b);let N=u.indexOf(`:${g}`);N>-1&&(u[N]=b);let D=n.indexOf(`:${g}`);D>-1&&(n[D]=b);let x=l.indexOf(`:${g}`);x>-1&&(l[x]=b)}a==!0&&(i[i.length-1]=u[0],u.shift()),h==!0&&(n[n.length-1]=l[0],l.shift()),t=i.concat(u).join("/");let P=n.concat(l).filter(g=>g.trim()!="").join("/");return P.trim()!=""&&(t=t.endsWith("/")?t.substring(0,t.length-1):t,t+=`#${P}`),t=t.replace("//","/"),t}compareLocations(t,e){let s=!1,r=!1;return e.pathname!=t.pathname?s=!0:e.pathname==t.pathname&&e.hash!=t.hash&&(s=!0,t.hash!=""&&e.hash!=""&&(r=!0)),{hasChanged:s,isReplacementChange:r}}pathIsActive(t){let[e,s]=this.destructurePath(t),r=this.getAttribute("path")??"/",{pathname:o,hash:i}=this.#n(r);[o,i]=this.destructurePath(o);let u=this.#i(e),a=this.#o(u,this.#a);if(a==null)return!1;let n=this.currentPageRoute==a;if(n==!0){let h=a.extractSubroute(e);if(a.getAttribute("subrouting")!="false"&&h!=""){let c=a.querySelector(":scope > path-router");c!=null&&(n=c.pathIsActive(h))}}let l=!1;return s==i&&(l=!0),!!(n==!0&&t.indexOf("#")==-1||n==!0&&l==!0||t.startsWith("#")&&l==!0)}static getUrlParameters(t){let s=new URL(t).pathname,o=(s.startsWith("/")?s.substring(1):s).split("/"),i={},u=null;for(let a=0;a<o.length;a++){let n=o[a];u==null?u=n:(i[u]=n,u=null)}return i}connectedCallback(){let t=this.getRootNode();t.adoptedStyleSheets.indexOf(O)==-1&&t.adoptedStyleSheets.push(O)}static observedAttributes=["path","subrouting"];attributeChangedCallback(t,e,s){if(t=="path")this.isInitialized==!0?this.#u(s,e??""):this.#e.push({newValue:s,oldValue:e??""});else if(t=="subrouting")if(s=="false"){this.subrouting=!1;for(let r=0;r<this.routes.length;r++)this.routes[r].setAttribute(t,"false")}else{this.subrouting=!0;for(let r=0;r<this.routes.length;r++)this.routes[r].removeAttribute("subrouting")}}};customElements.get(p)==null&&customElements.define(p,k);var f=class{path="";hash="";subroutePath="";subrouteHash="";properties={};isDialogRoute=!0};export{p as COMPONENT_TAG_NAME,k as PathRouterElement,w as PathRouterEvent};
