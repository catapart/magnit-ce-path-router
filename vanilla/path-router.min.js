var d="path-route",f=class extends HTMLElement{get router(){return this.closest(h)}blockingBeforeOpen=[];blockingAfterOpen=[];blockingBeforeClose=[];blockingAfterClose=[];currentProcess;canBeOpened;canBeClosed;constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML="<slot></slot>",this.currentProcess=Promise.resolve(),this.canBeOpened=async()=>!0,this.canBeClosed=async()=>!0}async open(t){return await this.canBeOpened()?(this.currentProcess=this.#t(t),await this.currentProcess,this.currentProcess=Promise.resolve(),!0):(console.info("Navigation blocked by validity check."),!1)}async#t(t){this.dataset.entering="";let e=this.getProperties(t);this.dispatchEvent(new CustomEvent("beforeopen",{detail:{path:t,properties:e}})),await Promise.allSettled(this.blockingBeforeOpen.map(s=>s())),await Promise.allSettled(this.getAnimations({subtree:!0}).map(s=>s.finished)),delete this.dataset.entering,this.toggleAttribute("open",!0),this.setAttribute("aria-current","page"),this.dispatchEvent(new Event("afteropen")),await Promise.allSettled(this.blockingAfterOpen.map(s=>s()))}async close(){return await this.canBeClosed()==!1?(console.info("Navigation blocked by validity check."),!1):(this.currentProcess=this.#e(),await this.currentProcess,this.currentProcess=Promise.resolve(),!0)}async#e(){this.removeAttribute("open"),this.dataset.exiting="",this.dispatchEvent(new Event("beforeclose")),await Promise.allSettled(this.blockingBeforeClose.map(t=>t())),await Promise.all(this.getAnimations({subtree:!0}).map(t=>t.finished)),delete this.dataset.exiting,this.removeAttribute("aria-current"),this.dispatchEvent(new Event("afterclose")),await Promise.allSettled(this.blockingAfterClose.map(t=>t()))}getProperties(t){let e=this.getAttribute("path")??"",o=(e.startsWith("/")?e.substring(1):e).split("/"),i=(t.startsWith("/")?t.substring(1):t).split("/"),u={};for(let a=0;a<o.length;a++){let l=o[a];if(l.startsWith(":")){let n=l.substring(1);n.endsWith("?")&&(n=n.substring(0,n.length-1)),u[n]=a<i.length?i[a]:""}}return u}applyEventListener(t,e,s){let o=this.getAttribute("open")!=null;this.addEventListener(t,e,s),(t=="beforeopen".toString()||t=="afteropen".toString())&&o==!0?this.dispatchEvent(new Event(t)):(t=="beforeclose".toString()||t=="afterclose".toString()&&o==!1)&&this.dispatchEvent(new Event(t))}addBlockingEventListener(t,e){switch(t){case"beforeopen":this.blockingBeforeOpen.push(e);break;case"afteropen":this.blockingAfterOpen.push(e);break;case"beforeclose":this.blockingBeforeClose.push(e);break;case"afterclose":this.blockingAfterClose.push(e);break}}applyBlockingEventListener(t,e){let s=this.getAttribute("open")!=null;this.addBlockingEventListener(t,e),(t=="beforeopen".toString()||t=="afteropen".toString())&&s==!0?this.dispatchEvent(new Event(t)):(t=="beforeclose".toString()||t=="afterclose".toString()&&s==!1)&&this.dispatchEvent(new Event(t))}};customElements.get(d)==null&&customElements.define(d,f);var g="route-dialog",m=class extends HTMLDialogElement{get router(){return this.closest(h)}blockingBeforeOpen=[];blockingAfterOpen=[];blockingBeforeClose=[];blockingAfterClose=[];currentProcess;canBeOpened;canBeClosed;constructor(){super(),this.currentProcess=Promise.resolve(),this.canBeOpened=async()=>!0,this.canBeClosed=async()=>!0}async openRoute(t){return await this.canBeOpened()?(this.currentProcess=this.#t(t),await this.currentProcess,this.currentProcess=Promise.resolve(),!0):(console.info("Navigation blocked by validity check."),!1)}async#t(t){this.setAttribute("data-entering","");let e=this.getProperties(t);this.dispatchEvent(new CustomEvent("beforeopen",{detail:{path:t,properties:e}})),await Promise.allSettled(this.blockingBeforeOpen.map(s=>s())),await Promise.allSettled(this.getAnimations({subtree:!0}).map(s=>s.finished)),this.removeAttribute("data-entering"),this.dataset.modal!=null?this.showModal():this.show(),this.setAttribute("aria-current","page"),this.dispatchEvent(new Event("afteropen")),await Promise.allSettled(this.blockingAfterOpen.map(s=>s()))}async closeRoute(){return await this.canBeClosed()==!1?(console.info("Navigation blocked by validity check."),!1):(this.currentProcess=this.#e(),await this.currentProcess,this.currentProcess=Promise.resolve(),!0)}async#e(){this.setAttribute("data-exiting",""),this.dispatchEvent(new Event("beforeclose")),await Promise.allSettled(this.blockingBeforeClose.map(t=>t())),await Promise.all(this.getAnimations({subtree:!0}).map(t=>t.finished)),this.close(),this.removeAttribute("aria-current"),this.dispatchEvent(new Event("afterclose")),await Promise.allSettled(this.blockingAfterClose.map(t=>t()))}getProperties(t){let e=this.getAttribute("path")??"",o=(e.startsWith("/")?e.substring(1):e).split("/"),i=(t.startsWith("/")?t.substring(1):t).split("/"),u={};for(let a=0;a<o.length;a++){let l=o[a];if(l.startsWith(":")){let n=l.substring(1);n.endsWith("?")&&(n=n.substring(0,n.length-1)),u[n]=a<i.length?i[a]:""}}return u}applyEventListener(t,e,s){let o=this.getAttribute("open")!=null;this.addEventListener(t,e,s),(t=="beforeopen".toString()||t=="afteropen".toString())&&o==!0?this.dispatchEvent(new Event(t)):(t=="beforeclose".toString()||t=="afterclose".toString()&&o==!1)&&this.dispatchEvent(new Event(t))}addBlockingEventListener(t,e){switch(t){case"beforeopen":this.blockingBeforeOpen.push(e);break;case"afteropen":this.blockingAfterOpen.push(e);break;case"beforeclose":this.blockingBeforeClose.push(e);break;case"afterclose":this.blockingAfterClose.push(e);break}}};customElements.get(g)==null&&customElements.define(g,m,{extends:"dialog"});var A="route-link",v=class extends HTMLAnchorElement{constructor(){super(),window.addEventListener("popstate",()=>this.setIsCurrent())}connectedCallback(){let t=this.getTarget();t?.addEventListener("pathchange",()=>this.setIsCurrent()),this.addEventListener("click",()=>{if(t==null)return;let e=this.getAttribute("path")??this.getAttribute("data-path")??"";t.dispatchEvent(new CustomEvent("navigate",{detail:{target:this,path:e}}))}),document.readyState=="complete"&&this.setIsCurrent()}getTarget(){let t=null,e=this.getAttribute("for");if(e!=null)t=this.getRootNode().querySelector(`#${e}`);else{let s=this.getAttribute("target");s!=null&&(t=this.getRootNode().querySelector(s))}return t}setIsCurrent(){let t=this.getAttribute("path");if(t==null)return;let e=this.getTarget();if(e==null)return;e.pathIsActive(t)?this.setAttribute("aria-current","page"):this.removeAttribute("aria-current")}};customElements.get(A)==null&&customElements.define(A,v,{extends:"a"});var C="route-button",E=class extends HTMLButtonElement{constructor(){super(),window.addEventListener("popstate",()=>this.setIsCurrent())}connectedCallback(){let t=this.getTarget();t?.addEventListener("pathchange",()=>this.setIsCurrent()),this.addEventListener("click",()=>{if(t==null)return;let e=this.getAttribute("path")??this.getAttribute("data-path")??"";t.dispatchEvent(new CustomEvent("navigate",{detail:{target:this,path:e}}))}),document.readyState=="complete"&&this.setIsCurrent()}getTarget(){let t=null,e=this.getAttribute("for");if(e!=null)t=this.getRootNode().querySelector(`#${e}`);else{let s=this.getAttribute("target");s!=null&&(t=this.getRootNode().querySelector(s))}return t}setIsCurrent(){let t=this.getAttribute("path");if(t==null)return;let e=this.getTarget();if(e==null)return;e.pathIsActive(t)?this.setAttribute("aria-current","page"):this.removeAttribute("aria-current")}};customElements.get(C)==null&&customElements.define(C,E,{extends:"button"});var P=(e=>(e.Change="change",e.PathChange="pathchange",e))(P||{}),R=new CSSStyleSheet;R.replaceSync(`:host
{
    display: grid;
    grid-template-columns: 1fr;
    grid-template-rows: 1fr;
}
::slotted(path-route)
{
    grid-column: 1;
    grid-row: 1;
    display: none;
}
::slotted(path-route[open])
{
    display: contents;
}`);var O="*",h="path-router",b=class extends HTMLElement{get routes(){return[].map.call(this.querySelectorAll(`:scope > ${d}`),t=>t)}get routeDialogs(){return[].map.call(this.querySelectorAll(`:scope > [is="${g}"]`),t=>t)}currentPathRoute;currentRouteDialog;defaultRoute;wildcardRoute;constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML="<slot></slot>",this.shadowRoot.adoptedStyleSheets.push(R),window.addEventListener("popstate",async t=>{let e=window.location.pathname+window.location.hash;this.navigate(e)}),this.addEventListener("navigate",async t=>{let{path:e}=t.detail;this.navigate(e)}),document.addEventListener("DOMContentLoaded",()=>{this.init()})}async navigate(t){let{pathName:e,hash:s}=this.destructurePath(t);await this.update(e,s);let o=`${e}${s.trim()!=""?"#":""}${s}`;this.setPath(o)}getPathElement(t,e){let s=e.map(i=>[i.getAttribute("path")??"",i]),o=new Map(s);t=t.startsWith("/")?t.substring(1):t;let r=null;t:for(let[i,u]of o){i=i.startsWith("/")?i.substring(1):i;let a=i.split("/"),l=t.split("/");for(let n=0;n<l.length;n++){if(n==l.length-1&&l[n]=="")continue;let p=a[n];if(p==null){r=null;continue t}if(!p.startsWith(":")&&p!=O&&p!=l[n])continue t;r=u}}return r}splitPath(t){let e=t.split("#"),s=e[0],o=t.length>1?e[1]:null,r=o==null?[""]:o.split("?"),i=r==null?"":r[0];return{path:s,hash:i}}destructurePath(t){let{path:e,hash:s}=this.splitPath(t);if(e.trim()==""&&s!=""){let o=this.getAttribute("path")??"",{path:r}=this.splitPath(o);e=r}return e=e.trim()==""?"/":e,{pathName:e,hash:s}}pathIsActive(t){let{path:e,hash:s}=this.splitPath(t);e=e.startsWith("/")?e.substring(1):e,s=s.startsWith("#")?s.substring(1):s;let o=this.getAttribute("path")??"/",{path:r,hash:i}=this.splitPath(o);r=r.startsWith("/")?r.substring(1):r,i=i.startsWith("#")?i.substring(1):i;let u=!1;e==r&&(u=!0);let a=!1;return s==i&&(a=!0),!!(u==!0&&t.indexOf("#")==-1||u==!0&&a==!0||t.startsWith("#")&&a==!0)}async init(){let t=[];for(let s=0;s<this.routes.length;s++){let o=this.routes[s];t.push(o.close()),this.defaultRoute==null&&(this.defaultRoute=o);let r=o.getAttribute("path"),i=o.hasAttribute("default");r!=null&&r.trim()=="*"&&(this.wildcardRoute=o),i==!0&&(this.defaultRoute=o)}let e=[...this.querySelectorAll("dialog")];for(let s=0;s<e.length;s++)e[s].addEventListener("close",async o=>{if(!(e[s].getAttribute("data-exiting")!=null)){let u=(this.getAttribute("path")??"/").split("#")[0];await this.navigate(u)}e[s].removeAttribute("data-exiting")});if(await Promise.allSettled(t),!this.hasAttribute("manual"))return this.navigate(this.getAttribute("path")??"")}async update(t,e){let s=this.getAttribute("path")??"",{path:o,hash:r}=this.splitPath(s),i=o!=t;i&&await this.openRoute(t),this.setAttribute("path",t),(i||r!=e)&&await this.openRouteDialog(e)}async openRoute(t){if(await Promise.allSettled(this.routes.map(r=>r.currentProcess)),await this.closeCurrentPathRoute()==!1)return!1;let s=this.getPathElement(t,this.routes);if(s==null&&this.wildcardRoute!=null&&(s=this.wildcardRoute),s=s||this.defaultRoute,s==null)return!1;let o=await s.open(t);return o&&(this.currentPathRoute=s,this.dispatchEvent(new CustomEvent("change",{detail:{route:s,path:t}}))),o}async openRouteDialog(t){let e=t.startsWith("#")?t.substring(1):t;if(await Promise.allSettled(this.routeDialogs.map(i=>i.currentProcess)),await this.closeCurrentRouteDialog()==!1)return!1;let o=this.getPathElement(e,this.routeDialogs);if(o==null)return!1;let r=await o.openRoute(t);return r&&(this.currentRouteDialog=o,this.dispatchEvent(new CustomEvent("change",{detail:{route:o,path:e}}))),r}setPath(t){this.setAttribute("path",t),this.dispatchEvent(new CustomEvent("pathchange",{detail:{path:t}}))}async closeCurrentPathRoute(){if(this.currentPathRoute==null)return!0;await Promise.allSettled(this.routes.map(e=>e.currentProcess));let t=await this.currentPathRoute.close();return t==!0&&(this.currentPathRoute=void 0),t}async closeCurrentRouteDialog(){if(this.currentRouteDialog==null)return!0;await Promise.allSettled(this.routeDialogs.map(e=>e.currentProcess));let t=await this.currentRouteDialog.closeRoute();return t==!0&&(this.currentRouteDialog=void 0),t}};customElements.get(h)==null&&customElements.define(h,b);export{h as COMPONENT_TAG_NAME,b as PathRouterComponent,P as PathRouterEvent};
